<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cr√©ateur d'overlay By Akatsuki Orga.</title>

  <!-- Export PNG (canvas) -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --bg: #07060a;

      /* Akatsuki palette */
      --red: rgba(255, 60, 90, 1);
      --redSoft: rgba(255, 60, 90, .22);
      --redGlow: rgba(255, 60, 90, .18);

      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);

      /* Transparent menu */
      --menu: rgba(0,0,0,.18);
      --menu2: rgba(0,0,0,.10);

      --stroke: rgba(255,255,255,.16);
      --strokeRed: rgba(255, 60, 90, .35);

      --shadow: 0 18px 40px rgba(0,0,0,.45);
      --inner: inset 0 1px 0 rgba(255,255,255,.16), inset 0 -18px 40px rgba(0,0,0,.35);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color: var(--text);
      min-height:100vh;

      /* fond neutre (ta page peut avoir son propre fond) */
      background:
        radial-gradient(900px 500px at 70% 15%, rgba(255,60,90,.18), transparent 60%),
        radial-gradient(900px 500px at 20% 75%, rgba(255,255,255,.06), transparent 60%),
        var(--bg);
    }

    .app{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
      padding: 18px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
    }

    /* MENU TRANSPARENT (glass) */
    .card{
      background: linear-gradient(180deg, var(--menu), var(--menu2));
      border: 1px solid var(--strokeRed);
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow:hidden;

      backdrop-filter: blur(14px) saturate(1.15);
      -webkit-backdrop-filter: blur(14px) saturate(1.15);
    }

    .sidebar{
      padding: 16px;
      position: sticky;
      top: 16px;
      height: fit-content;
    }

    .title{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }

    .title h1{
      font-size: 15px;
      line-height: 1.25;
      margin:0;
      letter-spacing:.2px;
    }

    .badge{
      font-size: 12px;
      color: rgba(255,255,255,.82);
      background: rgba(255,60,90,.12);
      border: 1px solid rgba(255,60,90,.35);
      padding: 6px 10px;
      border-radius: 999px;
      box-shadow: 0 0 0 3px rgba(255,60,90,.08);
      white-space:nowrap;
    }

    .section{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 700;
      transition: transform .08s ease, background .15s ease, border-color .15s ease, box-shadow .15s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      user-select:none;

      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    .btn:hover{
      background: rgba(0,0,0,.28);
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 0 0 3px rgba(255,255,255,.06);
    }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: linear-gradient(180deg, rgba(255,60,90,.20), rgba(255,60,90,.10));
      border-color: rgba(255,60,90,.38);
      box-shadow: 0 0 0 3px rgba(255,60,90,.10);
    }
    .btn.primary:hover{ box-shadow: 0 0 0 3px rgba(255,60,90,.16); }

    .btn.danger{
      background: rgba(255,60,90,.12);
      border-color: rgba(255,60,90,.30);
    }

    input[type="file"]{
      width: 100%;
      padding: 10px;
      background: rgba(0,0,0,.18);
      border: 1px dashed rgba(255,255,255,.20);
      border-radius: 14px;
      color: rgba(255,255,255,.70);
    }

    input[type="range"]{ width: 100%; }

    select{
      width: 100%;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(255,60,90,.28);
      border-radius: 14px;
      color: var(--text);
      outline:none;
      box-shadow: 0 0 0 3px rgba(255,60,90,.08);
    }

    .hint{
      font-size: 12px;
      color: rgba(255,255,255,.72);
      line-height: 1.35;
      margin-top: 8px;
    }

    .giftPreview{
      margin-top: 10px;
      display:flex;
      align-items:center;
      gap: 12px;
      padding: 10px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.16);
    }
    .giftPreview .thumb{
      width: 54px;
      height: 54px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .giftPreview img{
      width: 70%;
      height: 70%;
      object-fit: contain;
      filter: drop-shadow(0 12px 14px rgba(0,0,0,.45));
    }
    .giftPreview .meta{
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .giftPreview .meta .name{
      font-weight: 800;
      font-size: 13px;
    }
    .giftPreview .meta .sub{
      font-size: 12px;
      color: rgba(255,255,255,.70);
    }

    .main{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 14px;
      min-height: calc(100vh - 36px);
    }

    .stage-wrap{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .stage-toolbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }

    .footer-note{
      font-size: 12px;
      color: rgba(255,255,255,.75);
      opacity:.98;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,60,90,.30);
      background: rgba(255,60,90,.10);
      color: rgba(255,255,255,.88);
    }

    .stage{
      position:relative;
      border-radius: 26px;
      border: 1px solid rgba(255,60,90,.24);
      overflow:hidden;
      min-height: 560px;
      box-shadow: var(--shadow);
      background: rgba(0,0,0,.25);
    }

    .bg{
      position:absolute; inset:0;
      background-size: cover;
      background-position:center;
      filter: saturate(1.1) contrast(1.02);
      transform: scale(1.02);
    }

    .vignette{
      position:absolute; inset:0;
      background: radial-gradient(1200px 700px at 50% 35%, transparent 40%, rgba(0,0,0,.40) 100%);
      pointer-events:none;
    }

    .grid{
      position:absolute; inset: 40px;
      display:grid;
      gap: 26px;
      align-content:center;
      justify-content:center;
      grid-template-columns: repeat(var(--cols), minmax(110px, 1fr));
    }

    @media (max-width: 980px){
      .grid{ inset: 18px; gap: 16px; }
    }

    .cell{
      aspect-ratio: 1 / 1;
      border-radius: var(--r);
      position:relative;
      overflow:hidden;
      cursor:pointer;

      /* --- GLASSMORPHISM --- */
      background: linear-gradient(135deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 14px 30px rgba(0,0,0,.42), var(--inner);
      backdrop-filter: blur(var(--blur)) saturate(1.2);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(1.2);
    }

    .cell::before{
      content:"";
      position:absolute;
      inset: -2px;
      background:
        radial-gradient(220px 220px at 15% 10%, rgba(255,255,255,.28), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.18), transparent 40%);
      opacity: .65;
      pointer-events:none;
    }

    .cell::after{
      content:"";
      position:absolute; inset:0;
      border-radius: var(--r);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
      pointer-events:none;
    }

    .cell:hover{
      border-color: rgba(255,60,90,.35);
      box-shadow: 0 14px 30px rgba(0,0,0,.42), var(--inner), 0 0 0 3px rgba(255,60,90,.10);
    }

    .cell .giftInCell{
      position:absolute; inset: 16%;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }
    .cell .giftInCell img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 16px 18px rgba(0,0,0,.50));
    }

    .cell .empty{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 12px;
      color: rgba(255,255,255,.58);
      pointer-events:none;
      text-align:center;
      padding: 10px;
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- SIDEBAR -->
    <div class="card sidebar">
      <div class="title">
        <h1>Cr√©ateur d'overlay By Akatsuki Orga.</h1>
        <div class="badge">‚òÅÔ∏èü©∏ Akatsuki</div>
      </div>

      <div class="section">
        <label>üñºÔ∏è 1) Image de fond</label>
        <input id="bgInput" type="file" accept="image/*" />
        <div class="row" style="margin-top:10px;">
          <a class="btn primary" href="https://chatgpt.com" target="_blank" rel="noopener">
            ‚ú® Cr√©er mon fond sur chatgpt.com
          </a>
          <button class="btn" id="clearBg">Retirer le fond</button>
        </div>
        <div class="hint">
          ‚òÅÔ∏èü©∏ Conseil : fond en 1920√ó1080 (ou +) pour une nettet√© parfaite.
        </div>
      </div>

      <div class="section">
        <label>üéÅ 2) Choisir un cadeau</label>
        <select id="giftSelect"></select>

        <div class="giftPreview" id="giftPreview">
          <div class="thumb" id="giftThumb"></div>
          <div class="meta">
            <div class="name" id="giftName">Aucun cadeau s√©lectionn√©</div>
            <div class="sub">Clique sur une case pour placer ‚Ä¢ <span class="kbd">Double-clic</span> pour retirer</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button class="btn" id="deselect">D√©s√©lectionner</button>
        </div>

        <div class="hint">
          ‚ö†Ô∏è Les images sont charg√©es depuis <b>./gifts/</b>.  
          Tu ajoutes tes PNG et tu compl√®tes la liste <span class="kbd">GIFTS</span> dans le code.
        </div>
      </div>

      <div class="section">
        <label>üßä 3) R√©glages des cases ‚Äúverre‚Äù</label>

        <div class="row" style="width:100%;">
          <div style="flex:1; min-width: 150px;">
            <label style="margin-bottom:6px;">Disposition</label>
            <select id="layout">
              <option value="3x2">3 colonnes √ó 2 lignes (6)</option>
              <option value="5x2">5 colonnes √ó 2 lignes (10)</option>
              <option value="5x3" selected>5 colonnes √ó 3 lignes (15)</option>
              <option value="4x3">4 colonnes √ó 3 lignes (12)</option>
              <option value="6x3">6 colonnes √ó 3 lignes (18)</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label>üå´Ô∏è Flou (blur) : <span id="blurVal">16</span>px</label>
          <input id="blur" type="range" min="0" max="30" value="16" />
        </div>

        <div style="margin-top:12px;">
          <label>‚≠ï Arrondi : <span id="roundVal">22</span>px</label>
          <input id="round" type="range" min="8" max="40" value="22" />
        </div>

        <div class="hint">
          ü©∏ Flow : choisis un cadeau ‚Üí clique une case pour le placer.
        </div>
      </div>

      <div class="section">
        <label>üßπ 4) Actions</label>
        <div class="row">
          <button class="btn danger" id="resetGrid">Vider toutes les cases</button>
          <button class="btn primary" id="exportPng">Exporter en PNG</button>
        </div>
        <div class="hint">
          üì¶ L‚Äôexport sort l‚Äôoverlay tel que tu le vois (fond + cases + cadeaux).
        </div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main">
      <div class="stage-wrap">
        <div class="stage-toolbar">
          <div class="footer-note">
            ‚òÅÔ∏èü©∏ Clique un cadeau ‚Üí clique une case pour l‚Äôajouter. <span class="kbd">Double-clic</span> pour supprimer.
          </div>
        </div>

        <div class="stage" id="stage">
          <div class="bg" id="bg"></div>
          <div class="vignette"></div>
          <div class="grid" id="grid"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /**
     * ‚úÖ BANQUE DE CADEAUX (√† toi de remplir)
     * Mets tes PNG dans le dossier:  ./gifts/
     * Exemple: ./gifts/rose.png
     */
    const GIFTS = [
      { name: "Rose", file: "rose.png" },
      { name: "C≈ìur", file: "coeur.png" },
      { name: "TikTok", file: "tiktok.png" },
      { name: "Lune", file: "lune.png" },
      // Ajoute autant que tu veux ‚Üì
      // { name: "Galaxy", file: "galaxy.png" },
    ];

    // --- State ---
    const state = {
      selectedGiftUrl: null,
      selectedGiftName: null,
      cells: [],
      cols: 5,
      rows: 3,
      blur: 16,
      round: 22,
    };

    // --- Elements ---
    const bg = document.getElementById('bg');
    const bgInput = document.getElementById('bgInput');
    const clearBgBtn = document.getElementById('clearBg');

    const giftSelect = document.getElementById('giftSelect');
    const giftPreview = document.getElementById('giftPreview');
    const giftThumb = document.getElementById('giftThumb');
    const giftName = document.getElementById('giftName');

    const deselectBtn = document.getElementById('deselect');

    const layout = document.getElementById('layout');
    const grid = document.getElementById('grid');
    const stage = document.getElementById('stage');

    const blurRange = document.getElementById('blur');
    const blurVal = document.getElementById('blurVal');

    const roundRange = document.getElementById('round');
    const roundVal = document.getElementById('roundVal');

    const resetGridBtn = document.getElementById('resetGrid');
    const exportBtn = document.getElementById('exportPng');

    // --- Helpers ---
    function setCSSVars(){
      grid.style.setProperty('--cols', state.cols);
      grid.style.setProperty('--blur', state.blur + 'px');
      document.documentElement.style.setProperty('--r', state.round + 'px');

      blurVal.textContent = state.blur;
      roundVal.textContent = state.round;
    }

    function setLayout(value){
      const [c, r] = value.split('x').map(Number);
      state.cols = c;
      state.rows = r;
      state.cells = new Array(c * r).fill(null);
      renderGrid();
      setCSSVars();
    }

    function setSelectedGift(gift){
      if(!gift){
        state.selectedGiftUrl = null;
        state.selectedGiftName = null;
        renderGiftPreview();
        renderGrid();
        return;
      }
      const url = `./gifts/${gift.file}`;
      state.selectedGiftUrl = url;
      state.selectedGiftName = gift.name;
      renderGiftPreview();
      renderGrid();
    }

    function renderGiftSelect(){
      giftSelect.innerHTML = '';
      const opt0 = document.createElement('option');
      opt0.value = '';
      opt0.textContent = '‚Äî Aucun (d√©s√©lectionn√©) ‚Äî';
      giftSelect.appendChild(opt0);

      GIFTS.forEach((g, idx) => {
        const opt = document.createElement('option');
        opt.value = String(idx);
        opt.textContent = `üéÅ ${g.name}`;
        giftSelect.appendChild(opt);
      });
    }

    function renderGiftPreview(){
      giftThumb.innerHTML = '';
      if(!state.selectedGiftUrl){
        giftName.textContent = "Aucun cadeau s√©lectionn√©";
        return;
      }
      giftName.textContent = state.selectedGiftName || "Cadeau";
      const img = document.createElement('img');
      img.src = state.selectedGiftUrl;
      img.alt = state.selectedGiftName || "cadeau";
      giftThumb.appendChild(img);
    }

    function renderGrid(){
      grid.innerHTML = '';
      const total = state.cols * state.rows;

      for(let i=0; i<total; i++){
        const cell = document.createElement('div');
        cell.className = 'cell';

        const url = state.cells[i];

        if(url){
          const wrap = document.createElement('div');
          wrap.className = 'giftInCell';

          const img = document.createElement('img');
          img.src = url;
          img.alt = 'gift';

          wrap.appendChild(img);
          cell.appendChild(wrap);
        } else {
          const empty = document.createElement('div');
          empty.className = 'empty';
          empty.textContent = state.selectedGiftUrl ? 'Clique pour placer ‚òÅÔ∏è' : 'Choisis un cadeau ü©∏';
          cell.appendChild(empty);
        }

        // click = place if selected
        cell.addEventListener('click', () => {
          if(!state.selectedGiftUrl) return;
          state.cells[i] = state.selectedGiftUrl;
          renderGrid();
        });

        // dblclick = remove
        cell.addEventListener('dblclick', () => {
          state.cells[i] = null;
          renderGrid();
        });

        grid.appendChild(cell);
      }
    }

    // --- Background upload ---
    bgInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      bg.style.backgroundImage = `url("${url}")`;
    });

    clearBgBtn.addEventListener('click', () => {
      bg.style.backgroundImage = '';
      bgInput.value = '';
    });

    // --- Gift selection ---
    giftSelect.addEventListener('change', () => {
      const v = giftSelect.value;
      if(v === ''){
        setSelectedGift(null);
        return;
      }
      const idx = Number(v);
      const gift = GIFTS[idx];
      setSelectedGift(gift);
    });

    deselectBtn.addEventListener('click', () => {
      giftSelect.value = '';
      setSelectedGift(null);
    });

    // --- Controls ---
    layout.addEventListener('change', (e) => setLayout(e.target.value));

    blurRange.addEventListener('input', (e) => {
      state.blur = Number(e.target.value);
      setCSSVars();
    });

    roundRange.addEventListener('input', (e) => {
      state.round = Number(e.target.value);
      setCSSVars();
    });

    resetGridBtn.addEventListener('click', () => {
      state.cells = new Array(state.cols * state.rows).fill(null);
      renderGrid();
    });

    // --- Export PNG ---
    exportBtn.addEventListener('click', async () => {
      try{
        exportBtn.disabled = true;
        exportBtn.textContent = "‚è≥ Export en cours...";

        // important: scale pour plus de qualit√©
        const canvas = await html2canvas(stage, {
          backgroundColor: null,
          useCORS: true,
          scale: 2,
        });

        const dataUrl = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = dataUrl;
        a.download = `overlay-akatsuki-${Date.now()}.png`;
        document.body.appendChild(a);
        a.click();
        a.remove();
      } catch(err){
        alert("Export impossible (v√©rifie que tes images dans ./gifts/ sont accessibles).");
        console.error(err);
      } finally {
        exportBtn.disabled = false;
        exportBtn.textContent = "Exporter en PNG";
      }
    });

    // --- Init ---
    renderGiftSelect();
    setLayout(layout.value);

    state.blur = Number(blurRange.value);
    state.round = Number(roundRange.value);
    setCSSVars();

    // Optionnel: auto-s√©lectionner le 1er cadeau si tu veux
    // giftSelect.value = "0";
    // setSelectedGift(GIFTS[0]);

    renderGiftPreview();
    renderGrid();
  </script>
</body>
</html>

