<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Glass Overlay Creator</title>
  <style>
    :root{
      --bg: #0b1020;
      --panel: rgba(255,255,255,.08);
      --panel-2: rgba(255,255,255,.12);
      --stroke: rgba(255,255,255,.18);
      --stroke-2: rgba(255,255,255,.28);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.72);
      --shadow: 0 18px 40px rgba(0,0,0,.40);
      --inner: inset 0 1px 0 rgba(255,255,255,.20), inset 0 -18px 40px rgba(0,0,0,.35);
      --r: 22px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(900px 500px at 70% 15%, rgba(95,170,255,.28), transparent 60%),
                  radial-gradient(900px 500px at 20% 75%, rgba(255,110,180,.18), transparent 60%),
                  var(--bg);
      color: var(--text);
      min-height:100vh;
    }

    .app{
      display:grid;
      grid-template-columns: 360px 1fr;
      gap: 18px;
      padding: 18px;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border: 1px solid var(--stroke);
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .sidebar{
      padding: 16px;
      position: sticky;
      top: 16px;
      height: fit-content;
    }

    .title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom: 10px;
    }

    .title h1{
      font-size: 16px;
      margin:0;
      letter-spacing:.2px;
    }

    .badge{
      font-size: 12px;
      color: var(--muted);
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
      padding: 6px 10px;
      border-radius: 999px;
    }

    .section{
      margin-top: 14px;
      padding-top: 14px;
      border-top: 1px solid rgba(255,255,255,.10);
    }

    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .row{
      display:flex;
      gap: 10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .btn{
      cursor:pointer;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 14px;
      font-weight: 600;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.12); border-color: rgba(255,255,255,.22); }
    .btn:active{ transform: translateY(1px); }

    .btn.primary{
      background: linear-gradient(180deg, rgba(90,170,255,.22), rgba(90,170,255,.12));
      border-color: rgba(90,170,255,.35);
    }
    .btn.danger{
      background: rgba(255,80,110,.14);
      border-color: rgba(255,80,110,.25);
    }

    input[type="file"]{
      width: 100%;
      padding: 10px;
      background: rgba(255,255,255,.06);
      border: 1px dashed rgba(255,255,255,.20);
      border-radius: 14px;
      color: var(--muted);
    }

    input[type="range"]{ width: 100%; }

    select{
      width: 100%;
      padding: 10px 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 14px;
      color: var(--text);
      outline:none;
    }

    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
      margin-top: 8px;
    }

    .library{
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .gift{
      aspect-ratio: 1 / 1;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      cursor:pointer;
      position:relative;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    .gift:hover{ background: rgba(255,255,255,.10); border-color: rgba(255,255,255,.20); }
    .gift:active{ transform: translateY(1px); }
    .gift.selected{
      border-color: rgba(120,210,255,.65);
      box-shadow: 0 0 0 3px rgba(120,210,255,.18);
      background: rgba(120,210,255,.10);
    }
    .gift img{
      width: 70%;
      height: 70%;
      object-fit: contain;
      pointer-events:none;
      filter: drop-shadow(0 10px 14px rgba(0,0,0,.35));
    }

    .main{
      padding: 16px;
      display:flex;
      flex-direction:column;
      gap: 14px;
      min-height: calc(100vh - 36px);
    }

    .stage-wrap{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .stage-toolbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      flex-wrap:wrap;
    }

    .stage{
      position:relative;
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.14);
      overflow:hidden;
      min-height: 560px;
      box-shadow: var(--shadow);
      background: rgba(0,0,0,.25);
    }

    .bg{
      position:absolute; inset:0;
      background-size: cover;
      background-position:center;
      filter: saturate(1.1) contrast(1.02);
      transform: scale(1.02);
    }

    /* léger vignettage pour rendre l’effet plus "ciné" */
    .vignette{
      position:absolute; inset:0;
      background: radial-gradient(1200px 700px at 50% 35%, transparent 40%, rgba(0,0,0,.35) 100%);
      pointer-events:none;
    }

    .grid{
      position:absolute; inset: 40px;
      display:grid;
      gap: 26px;
      align-content:center;
      justify-content:center;
      grid-template-columns: repeat(var(--cols), minmax(110px, 1fr));
    }

    @media (max-width: 980px){
      .grid{ inset: 18px; gap: 16px; }
    }

    .cell{
      aspect-ratio: 1 / 1;
      border-radius: var(--r);
      position:relative;
      overflow:hidden;
      cursor:pointer;

      /* --- GLASSMORPHISM --- */
      background: linear-gradient(135deg, rgba(255,255,255,.16), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.20);
      box-shadow: 0 14px 30px rgba(0,0,0,.40), var(--inner);
      backdrop-filter: blur(var(--blur)) saturate(1.2);
      -webkit-backdrop-filter: blur(var(--blur)) saturate(1.2);
    }

    /* reflet “verre” en coin */
    .cell::before{
      content:"";
      position:absolute;
      inset: -2px;
      background:
        radial-gradient(220px 220px at 15% 10%, rgba(255,255,255,.28), transparent 55%),
        linear-gradient(135deg, rgba(255,255,255,.18), transparent 40%);
      opacity: .65;
      pointer-events:none;
    }

    /* petit highlight de bord */
    .cell::after{
      content:"";
      position:absolute; inset:0;
      border-radius: var(--r);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
      pointer-events:none;
    }

    .cell:hover{
      border-color: rgba(255,255,255,.34);
      background: linear-gradient(135deg, rgba(255,255,255,.18), rgba(255,255,255,.07));
    }

    .cell .giftInCell{
      position:absolute; inset: 16%;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }
    .cell .giftInCell img{
      width: 100%;
      height: 100%;
      object-fit: contain;
      filter: drop-shadow(0 16px 18px rgba(0,0,0,.45));
    }

    .cell .empty{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      pointer-events:none;
      text-align:center;
      padding: 8px;
    }

    .footer-note{
      font-size: 12px;
      color: var(--muted);
      opacity:.95;
    }

    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.82);
    }
  </style>
</head>

<body>
  <div class="app">
    <!-- SIDEBAR -->
    <div class="card sidebar">
      <div class="title">
        <h1>Glass Overlay Creator</h1>
        <div class="badge">verre + cadeaux</div>
      </div>

      <div class="section">
        <label>1) Image de fond</label>
        <input id="bgInput" type="file" accept="image/*" />
        <div class="row" style="margin-top:10px;">
          <a class="btn primary" href="https://chatgpt.com" target="_blank" rel="noopener">
            ✨ Créer mon fond sur chatgpt.com
          </a>
          <button class="btn" id="clearBg">Retirer le fond</button>
        </div>
        <div class="hint">
          Astuce : utilise une image 16:9 (1920×1080) ou plus pour un rendu bien net.
        </div>
      </div>

      <div class="section">
        <label>2) Importer des cadeaux (PNG transparents)</label>
        <input id="giftInput" type="file" accept="image/png,image/webp,image/*" multiple />
        <div class="hint">
          Tu peux importer un pack de PNG (cadeaux TikTok). Ensuite clique sur un cadeau,
          puis clique sur une case pour le placer.
        </div>

        <div class="library" id="library"></div>

        <div class="row" style="margin-top:10px;">
          <button class="btn danger" id="clearGifts">Vider la banque</button>
          <button class="btn" id="deselect">Désélectionner</button>
        </div>
      </div>

      <div class="section">
        <label>3) Réglages des cases “verre”</label>
        <div class="row" style="width:100%;">
          <div style="flex:1; min-width: 150px;">
            <label style="margin-bottom:6px;">Disposition</label>
            <select id="layout">
              <option value="5x2">5 colonnes × 2 lignes (10)</option>
              <option value="5x3" selected>5 colonnes × 3 lignes (15)</option>
              <option value="4x3">4 colonnes × 3 lignes (12)</option>
              <option value="6x3">6 colonnes × 3 lignes (18)</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px;">
          <label>Flou (blur) : <span id="blurVal">16</span>px</label>
          <input id="blur" type="range" min="0" max="30" value="16" />
        </div>

        <div style="margin-top:12px;">
          <label>Arrondi : <span id="roundVal">22</span>px</label>
          <input id="round" type="range" min="8" max="40" value="22" />
        </div>

        <div class="hint">
          Raccourci : clic sur une case avec un cadeau sélectionné = placer.  
          Double-clic sur une case = retirer le cadeau.
        </div>
      </div>

      <div class="section">
        <label>4) Nettoyage</label>
        <div class="row">
          <button class="btn danger" id="resetGrid">Vider toutes les cases</button>
        </div>
        <div class="hint">
          (Option export PNG possible ensuite — si tu veux je te l’ajoute.)
        </div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="main">
      <div class="stage-wrap">
        <div class="stage-toolbar">
          <div class="footer-note">
            Clique un cadeau → clique une case pour l’ajouter.  
            <span class="kbd">Double-clic</span> sur une case pour supprimer.
          </div>
        </div>

        <div class="stage" id="stage">
          <div class="bg" id="bg"></div>
          <div class="vignette"></div>
          <div class="grid" id="grid"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- State ---
    const state = {
      selectedGiftUrl: null,
      giftItems: [],     // { name, url }
      cells: [],         // url or null per cell
      cols: 5,
      rows: 3,
      blur: 16,
      round: 22,
    };

    // --- Elements ---
    const bg = document.getElementById('bg');
    const bgInput = document.getElementById('bgInput');
    const clearBgBtn = document.getElementById('clearBg');

    const giftInput = document.getElementById('giftInput');
    const library = document.getElementById('library');
    const clearGiftsBtn = document.getElementById('clearGifts');
    const deselectBtn = document.getElementById('deselect');

    const layout = document.getElementById('layout');
    const grid = document.getElementById('grid');
    const stage = document.getElementById('stage');

    const blurRange = document.getElementById('blur');
    const blurVal = document.getElementById('blurVal');

    const roundRange = document.getElementById('round');
    const roundVal = document.getElementById('roundVal');

    const resetGridBtn = document.getElementById('resetGrid');

    // --- Helpers ---
    function setCSSVars(){
      grid.style.setProperty('--cols', state.cols);
      grid.style.setProperty('--blur', state.blur + 'px');
      document.documentElement.style.setProperty('--r', state.round + 'px');

      blurVal.textContent = state.blur;
      roundVal.textContent = state.round;
    }

    function setLayout(value){
      const [c, r] = value.split('x').map(Number);
      state.cols = c;
      state.rows = r;
      state.cells = new Array(c * r).fill(null);
      renderGrid();
      setCSSVars();
    }

    function renderLibrary(){
      library.innerHTML = '';
      state.giftItems.forEach((g, idx) => {
        const div = document.createElement('div');
        div.className = 'gift' + (state.selectedGiftUrl === g.url ? ' selected' : '');
        div.title = g.name || 'cadeau';

        const img = document.createElement('img');
        img.src = g.url;
        img.alt = g.name || 'cadeau';

        div.appendChild(img);

        div.addEventListener('click', () => {
          state.selectedGiftUrl = g.url;
          renderLibrary();
        });

        library.appendChild(div);
      });

      if(state.giftItems.length === 0){
        library.innerHTML = `
          <div class="hint" style="grid-column:1/-1; padding:10px; border:1px dashed rgba(255,255,255,.18); border-radius:14px;">
            Aucun cadeau importé pour l’instant. Importe des PNG via “Importer des cadeaux”.
          </div>
        `;
      }
    }

    function renderGrid(){
      grid.innerHTML = '';
      const total = state.cols * state.rows;

      for(let i=0; i<total; i++){
        const cell = document.createElement('div');
        cell.className = 'cell';

        // contenu
        const url = state.cells[i];

        if(url){
          const wrap = document.createElement('div');
          wrap.className = 'giftInCell';

          const img = document.createElement('img');
          img.src = url;
          img.alt = 'gift';

          wrap.appendChild(img);
          cell.appendChild(wrap);
        } else {
          const empty = document.createElement('div');
          empty.className = 'empty';
          empty.textContent = state.selectedGiftUrl ? 'Clique pour placer' : 'Choisis un cadeau';
          cell.appendChild(empty);
        }

        // click = place if selected
        cell.addEventListener('click', () => {
          if(!state.selectedGiftUrl) return;
          state.cells[i] = state.selectedGiftUrl;
          renderGrid();
        });

        // dblclick = remove
        cell.addEventListener('dblclick', () => {
          state.cells[i] = null;
          renderGrid();
        });

        grid.appendChild(cell);
      }
    }

    // --- Background upload ---
    bgInput.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if(!file) return;
      const url = URL.createObjectURL(file);
      bg.style.backgroundImage = `url("${url}")`;
    });

    clearBgBtn.addEventListener('click', () => {
      bg.style.backgroundImage = '';
      bgInput.value = '';
    });

    // --- Gift upload (multiple) ---
    giftInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files || []);
      if(files.length === 0) return;

      const newItems = files.map(f => ({
        name: f.name,
        url: URL.createObjectURL(f),
      }));

      state.giftItems = [...state.giftItems, ...newItems];
      renderLibrary();
      // auto-select first new gift if none selected
      if(!state.selectedGiftUrl && state.giftItems.length){
        state.selectedGiftUrl = state.giftItems[0].url;
        renderLibrary();
      }
    });

    clearGiftsBtn.addEventListener('click', () => {
      state.giftItems = [];
      state.selectedGiftUrl = null;
      giftInput.value = '';
      renderLibrary();
      renderGrid();
    });

    deselectBtn.addEventListener('click', () => {
      state.selectedGiftUrl = null;
      renderLibrary();
      renderGrid();
    });

    // --- Controls ---
    layout.addEventListener('change', (e) => setLayout(e.target.value));

    blurRange.addEventListener('input', (e) => {
      state.blur = Number(e.target.value);
      setCSSVars();
    });

    roundRange.addEventListener('input', (e) => {
      state.round = Number(e.target.value);
      setCSSVars();
    });

    resetGridBtn.addEventListener('click', () => {
      state.cells = new Array(state.cols * state.rows).fill(null);
      renderGrid();
    });

    // --- Init ---
    setLayout(layout.value);
    state.blur = Number(blurRange.value);
    state.round = Number(roundRange.value);
    setCSSVars();
    renderLibrary();
    renderGrid();
  </script>
</body>
</html>
